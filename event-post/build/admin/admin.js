var ep_map=null,ep_can_drag_map=null,ep_view=null,ep_vectorSource=null,ep_feature=null,ep_proj_source=null,ep_proj_destination=null,marker=null,ep_marker=null,lat=null,lon=null,map_id=null,map_coord=null,current_id=null,ep_geoloasked=!1,ep_geolocalized=!1,ep_currentloc=[0,0];function eventpost_numdate(e){var t=new RegExp("[-: T/]","g");return e.replace&&(e=e.replace(t,"")),parseInt(e)}function eventpost_getdate(e){e=jQuery("#"+e+"_date").val();return e?eventpost_numdate(e.substring(0,16)+":00"):""}function eventpost_getdate_sql(e){return jQuery("#"+e+"_date").val()}function eventpost_concat_time(){jQuery(".eventpost-datepicker-simple-wrap").each(function(){var e=jQuery(this).find(".eventpost-datepicker-simple-date").val()+" "+jQuery(this).find(".eventpost-datepicker-simple-hour").val()+":"+jQuery(this).find(".eventpost-datepicker-simple-time").val()+":00";jQuery(this).find(".eventpost-datepicker-simple").val(e)}),jQuery(".eventpost-datepicker-native-wrap").each(function(){var e=parseInt(jQuery(this).find(".eventpost-datepicker-native-year").val()),t=parseInt(jQuery(this).find(".eventpost-datepicker-native-month").val()),a=(t<10&&(t="0"+t),parseInt(jQuery(this).find(".eventpost-datepicker-native-day").val())),n=(a<10&&(a="0"+a),parseInt(jQuery(this).find(".eventpost-datepicker-native-hour").val())),r=(n<10&&(n="0"+n),parseInt(jQuery(this).find(".eventpost-datepicker-native-minute").val())),e=(r<10&&(r="0"+r),e+"-"+t+"-"+a+" "+(isNaN(n)?"00":n)+":"+(isNaN(r)?"00":r)+":00");jQuery(this).find(".eventpost-datepicker-native").val(e)})}function eventpost_set_allday(){!0===jQuery("#event-post-date-all-day").is(":checked")?jQuery(".eventpost-datepicker-native-hour, .eventpost-datepicker-native-minute, .eventpost-datepicker-simple-hour, .eventpost-datepicker-simple-time").val("00").trigger("change").parent().hide(300):jQuery(".eventpost-datepicker-native-hour, .eventpost-datepicker-native-minute, .eventpost-datepicker-simple-hour, .eventpost-datepicker-simple-time").parent().show(300)}function eventpost_chkdate(){var e=eventpost_getdate(EventPost.admin.META_START),t=eventpost_getdate(EventPost.admin.META_END);if(""===t||t<e){jQuery("#"+EventPost.admin.META_END+"_date").val(jQuery("#"+EventPost.admin.META_START+"_date").val()),jQuery("#"+EventPost.admin.META_END+"_date").parents("label").find(".human_date").html(jQuery("#"+EventPost.admin.META_START+"_date").parents("label").find(".human_date").html()),jQuery("#"+EventPost.admin.META_END+"_date").parents("label").effect("shake");var a,n=["simple-date","simple-hour","simple-time","native-year","native-month","native-day","native-hour","native-minute"];for(a in n){var r=n[a];jQuery(".eventpost-datepicker-"+r,jQuery("#"+EventPost.admin.META_END+"_date").parents("label")).val(jQuery(".eventpost-datepicker-"+r,jQuery("#"+EventPost.admin.META_START+"_date").parents("label")).val())}jQuery(".eventpost-datepicker-control",jQuery("#"+EventPost.admin.META_END+"_date").parents("label")).last().trigger("change"),t=e}0===e?jQuery("#eventpost-datepicker-simple-wrap-event_begin_date .remove-timestamp").hide():jQuery("#eventpost-datepicker-simple-wrap-event_begin_date .remove-timestamp").show(),0===t?jQuery("#eventpost-datepicker-simple-wrap-event_end_date .remove-timestamp").hide():jQuery("#eventpost-datepicker-simple-wrap-event_end_date .remove-timestamp").show()}function eventpost_getlocation(e){e.coords.latitude,e.coords.longitude}function eventpost_location(){return"geolocation"in navigator&&(!1===ep_geoloasked?(ep_geoloasked=!0,navigator.geolocation.getCurrentPosition(eventpost_getlocation),navigator.geolocation.watchPosition(function(e){!1===ep_geolocalized&&(ep_geolocalized=!0,eventpost_getlocation(e),eventpost_apply("",ep_currentloc[0],ep_currentloc[1]))})):!0===ep_geolocalized&&eventpost_apply("",ep_currentloc[0],ep_currentloc[1])),"no"!==ep_currentloc?ep_currentloc:[lat,lon]}function eventpost_apply(e,t,a){""===jQuery("#geo_address").val()&&""!==e&&jQuery("#geo_address").val(e),jQuery("#geo_latitude").val(t),jQuery("#geo_longitude").val(a).trigger("change"),eventpost_search_form()}function eventpost_search_location(){var e,t=jQuery("#event_address_search_txt").val();""===t?(eventpost_search_form(),jQuery("#eventaddress_result").append('<span class="alert">'+EventPost.admin.empty_address+"</span>")):(e={action:"EventPostGetLatLong",q:t},jQuery("#eventaddress_result").html(t+'<br/><img src="'+EventPost.admin.imgpath+'loader.gif" alt="..."/>'),jQuery.post(EventPost.admin.ajaxurl,e,function(e){eventpost_search_form();var t,a,n="";for(a in e)void 0!==(a=e[a]).lat&&void 0!==a.lon&&void 0!==a.display_name&&(n='<a data-name="'+a.display_name.replace("'","&apos;").replace('"',"&quot;")+'" data-lat="'+a.lat+'" data-lon="'+a.lon+'">',void 0!==a.icon&&(n+='<img src="'+a.icon+'" alt="'+a.type+'"/>'),n+=a.display_name+"</a>",t=jQuery(n).on("click",function(){eventpost_apply(jQuery(this).data("name"),jQuery(this).data("lat"),jQuery(this).data("lon"))})),jQuery("#eventaddress_result").append(t.wrap("<p>").parent())},"json"))}function eventpost_search_form(){jQuery("#eventaddress_result").html(`<input type="search" id="event_address_search_txt" placeholder="${EventPost.admin.search}"/><button id="event_address_search_bt" class="button"><span class="dashicons dashicons-search"></span><span class="screen-reader-text">${EventPost.admin.search_button}</span></button>&nbsp;<small>${EventPost.admin.geocoding_attribution}</small>`),jQuery("#event_address_search_txt").on("keydown",function(e){if(13===(e.keyCode||e.which))return e.preventDefault(),eventpost_search_location(),!1}),jQuery("#event_address_search_bt").on("click",function(){eventpost_search_location()})}function ep_set_coord(){var e=parseFloat(jQuery("#geo_latitude").val()),t=parseFloat(jQuery("#geo_longitude").val()),a=(isNaN(e)&&(e=0),isNaN(t)&&(t=0),EventPost.OL.transform([t,e],ep_proj_source,ep_proj_destination));ep_map.getView().setCenter(a),0===e&&0===t?ep_map.getView().setZoom(1):ep_map.getView().setZoom(12)}function ep_set_can_drag(e){!0===e?(ep_can_drag_map=!0,jQuery(".ep-block-draging").hide(),jQuery(".ep-stop-draging").show()):(ep_can_drag_map=!1,jQuery(".ep-block-draging").show(),jQuery(".ep-stop-draging").hide())}jQuery(document).ready(function(){jQuery("#event_address_coords").hide(),jQuery("#event_address_search").on("click",function(){"block"===jQuery("#event_address_coords").css("display")?jQuery("#event_address_coords").hide(100):(jQuery("#event_address_coords").show(100),eventpost_search_form())}),jQuery("#event_address_unsearch").on("click",function(){jQuery("#event_address_coords").hide()}),jQuery("#eventpost-color-dropdown").hide().before(' <a href="#" id="event-color-section-more-btn">'+EventPost.admin.datepickeri18n.edit+"</a>"),jQuery("#eventpost-color-preview, #event-color-section-more-btn").on("click",function(e){e.preventDefault(),jQuery("#eventpost-color-dropdown").toggle(300)}),eventpost_chkdate(),jQuery(".eventpost-datepicker-simple").each(function(){var e=jQuery(this).val(),t=jQuery(this).attr("id");jQuery(this).wrap('<div class="eventpost-datepicker-simple-wrap eventpost-date-wrapper" id="eventpost-datepicker-simple-wrap-'+t+'" data-id="'+t+'">'),jQuery(this).after('<input  class="eventpost-datepicker-control eventpost-datepicker-simple-date" value="'+e.substr(0,10)+'" size="10" data-value="'+e.substr(0,10)+'"><label><span class="screen-reader-text">'+EventPost.admin.datepickeri18n.hour+'</span><select class="eventpost-datepicker-control eventpost-datepicker-simple-hour" data-value="'+e.substr(11,2)+'"></select></label><label><span class="screen-reader-text">'+EventPost.admin.datepickeri18n.minute+'</span><select class="eventpost-datepicker-control eventpost-datepicker-simple-time" data-value="'+e.substr(14,2)+'"></select></label>'),jQuery(this).hide();for(var a=0;a<24;a++){var n=9<a?a:"0"+a,r=n;"en"===EventPost.admin.lang&&(r=0==a?"12 AM":a<12?a+" AM":12==a?"12 PM":a-12+" PM"),jQuery("#eventpost-datepicker-simple-wrap-"+t+" .eventpost-datepicker-simple-hour").append('<option value="'+n+'"'+(a===parseInt(e.substr(11,2))?" selected":"")+">"+r+"</option>")}for(var o=!1,s=0;s<60;s+=5){var i=9<s?s:"0"+s,p="";!o&&Math.abs(s-parseInt(e.substr(14,2)))<=3&&(p=" selected",o=!0),jQuery("#eventpost-datepicker-simple-wrap-"+t+" .eventpost-datepicker-simple-time").append('<option value="'+i+'"'+p+">"+i+"</option>")}}),jQuery.datepicker&&jQuery(".eventpost-datepicker-simple-date").wrap('<div class="eventpost-datepicker-simple-inputgroup">').datepicker({firstDay:1,changeYear:!0,changeMonth:!0,showMonthAfterYear:!0,yearRange:"c-5:+5",buttonText:EventPost.admin.date_choose,showOn:"both",dateFormat:"yy-mm-dd",autoSize:!0,beforeShow:function(e,t){setTimeout(function(){jQuery("#ui-datepicker-div").css({"z-index":999})},0)}}),jQuery(".eventpost-datepicker-native").each(function(){var e=jQuery(this).val(),t=jQuery(this).attr("id"),a=(jQuery(this).wrap('<div class="timestamp-wrap eventpost-timestamp-wrap eventpost-date-wrapper eventpost-datepicker-native-wrap" id="eventpost-datepicker-native-wrap-'+t+'" data-id="'+t+'">'),'<label><span class="screen-reader-text">'+EventPost.admin.datepickeri18n.month+'</span><select class="eventpost-datepicker-control eventpost-datepicker-native-month" id="eventpost-datepicker-native-'+t+'-month" data-value="'+e.substr(5,2)+'"></select></label>'),n='<label><span class="screen-reader-text">'+EventPost.admin.datepickeri18n.day+'</span><input type="text" class="eventpost-datepicker-control eventpost-datepicker-native-day" id="eventpost-datepicker-native-'+t+'-day" value="'+e.substr(8,2)+'" data-value="'+e.substr(8,2)+'" size="2" maxlength="2" autocomplete="off" /></label>',r='<label><span class="screen-reader-text">'+EventPost.admin.datepickeri18n.year+'</span><input type="text" class="eventpost-datepicker-control eventpost-datepicker-native-year" id="eventpost-datepicker-native-'+t+'-year" value="'+e.substr(0,4)+'" data-value="'+e.substr(0,4)+'" size="4" maxlength="4" autocomplete="off" /></label>',o='<label><span class="screen-reader-text">'+EventPost.admin.datepickeri18n.hour+'</span><input type="text" class="eventpost-datepicker-control eventpost-datepicker-native-hour" id="eventpost-datepicker-native-'+t+'-hour" value="'+e.substr(11,2)+'" data-value="'+e.substr(11,2)+'" size="2" maxlength="2" autocomplete="off" /></label>',t='<label><span class="screen-reader-text">'+EventPost.admin.datepickeri18n.minute+'</span><input type="text" class="eventpost-datepicker-control eventpost-datepicker-native-minute" id="eventpost-datepicker-native-'+t+'-minute" value="'+e.substr(14,2)+'" data-value="'+e.substr(14,2)+'" size="2" maxlength="2" autocomplete="off" /></label>',s=EventPost.admin.datepickeri18n.order;s=(s=(s=(s=(s=s.replace("%1$s",a)).replace("%2$s",n)).replace("%3$s",r)).replace("%4$s",o)).replace("%5$s",t),jQuery(this).after(s);for(var i=1;i<=12;i+=1){var p=9<i?i:"0"+i,d="";p===e.substr(5,2)&&(d=" selected"),jQuery("select",jQuery(this).parent()).append('<option value="'+p+'"'+d+">"+p+"-"+EventPost.admin.datepickeri18n.months[i]+"</option>")}}).hide(),jQuery(".postbox .eventpost-datepicker-simple-wrap, .postbox .eventpost-datepicker-native-wrap").each(function(){jQuery(this).append('<span>\n<a href="#eventpost-edit_timestamp-'+current_id+'" class="save-timestamp hide-if-no-js button">'+EventPost.admin.datepickeri18n.ok+'</a>\n<a href="#eventpost-edit_timestamp-'+current_id+'" class="cancel-timestamp hide-if-no-js button-cancel">'+EventPost.admin.datepickeri18n.cancel+'</a>\n<a href="#eventpost-edit_timestamp-'+current_id+'" class="remove-timestamp hide-if-no-js button-link-delete">'+EventPost.admin.datepickeri18n.remove+"</a>\n</span>").before('<a href="#'+jQuery(this).attr("id")+'" class="eventpost-datepicker-native-edit-link">'+EventPost.admin.datepickeri18n.edit+"</a>")}).hide(),jQuery(".eventpost-datepicker-simple-edit-link, .eventpost-datepicker-native-edit-link").on("click",function(e){e.preventDefault(),jQuery(this).next(".eventpost-datepicker-simple-wrap, .eventpost-datepicker-native-wrap").toggle(300)}),jQuery(".eventpost-datepicker-simple-wrap .save-timestamp, .eventpost-datepicker-native-wrap .save-timestamp").on("click",function(e){jQuery(this).parent().parent().toggle(300)}),jQuery(".eventpost-datepicker-simple-wrap .cancel-timestamp, .eventpost-datepicker-native-wrap .cancel-timestamp").on("click",function(e){jQuery(".eventpost-datepicker-control",jQuery(this).parent().parent()).each(function(){jQuery(this).val(jQuery(this).data("value"))}).last().trigger("change"),jQuery(this).parent().parent().toggle(300)}),jQuery(".eventpost-datepicker-simple-wrap .remove-timestamp, .eventpost-datepicker-native-wrap .remove-timestamp").on("click",function(e){jQuery(".eventpost-datepicker-control",jQuery(this).parent().parent()).each(function(){jQuery(this).val("")}).last().trigger("change"),jQuery(this).parent().parent().toggle(300)}),jQuery(".eventpost-datepicker-control").on("change",function(){eventpost_concat_time(),eventpost_chkdate();var e=jQuery(this).parents(".eventpost-date-wrapper").data("id").replace("_date",""),t=jQuery("#"+e+"_date_human");""!==jQuery(this).val()&&null!==jQuery(this).val()?jQuery.post(EventPost.admin.ajaxurl,{action:"EventPostHumanDate",date:eventpost_getdate_sql(e)},function(e){t.html(e)}):t.text(EventPost.admin.pick_a_date)}),jQuery("#event-post-date-all-day").on("change click",function(){eventpost_set_allday()}),eventpost_set_allday(),void 0!==EventPost.OL&&(ep_feature=ep_vectorSource=ep_map=void 0,ep_proj_source=new EventPost.OL.Projection({code:"EPSG:4326"}),ep_proj_destination=new EventPost.OL.Projection({code:"EPSG:900913"}),marker="",ep_marker=void 0,lon=lat=0,map_id="event-post-map-preview"),setTimeout(function(){jQuery("#"+map_id).each(function(){marker=jQuery(this).data("marker"),jQuery(this).css({"min-width":"200px",width:"100%",height:"200px",position:"relative",cursor:"move"});var e=EventPost.OL.transform([lon,lat],ep_proj_source,ep_proj_destination);ep_vectorSource=new EventPost.OL.VectorSource,ep_view=new EventPost.OL.View({center:e,zoom:12}),(ep_map=new EventPost.OL.Map({target:map_id,layers:[new EventPost.OL.TileLayer({source:new EventPost.OL.XYZ({urls:EventPost.front.maptiles[EventPost.front.defaulttile].urls})}),new EventPost.OL.VectorLayer({source:ep_vectorSource})],view:ep_view})).addControl(new EventPost.OL.Zoom),jQuery(this).after('<img id="'+map_id+'-fixed-marker" src="'+marker+'" tabIndex="-1" draggable="false" alt="position">'),jQuery(this).after('<div id="'+map_id+'-startdrag" class="ep-block-draging"><span>'+EventPost.admin.start_drag+"</span></div>"),jQuery(this).after('<a id="'+map_id+'-stopdrag" class="ep-stop-draging button button-default">'+EventPost.admin.stop_drag+"</a>"),jQuery(this).after('<p style="text-align:center;"><a class="button button-default" id="'+map_id+'-get-current-loc"><span class="dashicons dashicons-marker"></span> '+EventPost.admin.use_current_location+"</a></p>"),jQuery("#"+map_id+"-fixed-marker").css({left:jQuery(this).width()/2-16,top:84}),jQuery("#"+map_id+"-get-current-loc").on("click",function(){eventpost_location()}),jQuery(".ep-stop-draging").hide().on("click",function(){ep_set_can_drag(!1)}),jQuery(".ep-block-draging").on("click",function(){ep_set_can_drag(!0)}),ep_map.on("moveend",function(){var e;ep_can_drag_map&&(map_coord=ep_view.getCenter(),0===(e=EventPost.OL.transform(map_coord,ep_proj_destination,ep_proj_source))[0]&&0===e[1]&&(e=["",""]),jQuery("#geo_longitude").val(e[0]),jQuery("#geo_latitude").val(e[1]))}),ep_set_coord(),jQuery("#geo_longitude, #geo_latitude").on("change blur",function(){ep_set_coord()})})},2e3),jQuery("#event_post_date .event-color-section label").on("focus click",function(){jQuery("#"+map_id+"-fixed-marker").attr("src",jQuery("img",jQuery(this)).attr("src"))}),jQuery("body").hasClass("widgets-php")&&jQuery(".widget").each(function(){-1<(wid=jQuery(this).attr("id")).indexOf("eventpostmap")?jQuery(this).addClass("eventpost_admin_widget eventpost_widget_map"):-1<wid.indexOf("eventpostcal")?jQuery(this).addClass("eventpost_admin_widget eventpost_widget_cal"):-1<wid.indexOf("eventpost")&&jQuery(this).addClass("eventpost_admin_widget eventpost_widget_list")});function e(){var e=jQuery("#event_attendance_mode").val();"OfflineEventAttendanceMode"===e&&(jQuery(".eventpost-location-type-offline").show(),jQuery(".eventpost-location-type-online").hide()),"OnlineEventAttendanceMode"===e&&(jQuery(".eventpost-location-type-offline").hide(),jQuery(".eventpost-location-type-online").show()),"MixedEventAttendanceMode"===e&&(jQuery(".eventpost-location-type-offline").show(),jQuery(".eventpost-location-type-online").show())}jQuery("#event_attendance_mode").on("change blur",e),e()}),window.onload=function(){jQuery(".color-field-post").each(function(){jQuery(this).wpColorPicker({palettes:EventPost.admin.palette,change:function(e,t){var t=(t=t.color.toString()).replace("#",""),e=jQuery(e.target).closest(".event-color-section"),a=e.find(".eventpost-iconpicker"),e=e.find(".custom-marker-container"),n=e.find(".image-marker"),r=e.find(".color-hex");void 0!==EventPost.admin.available_images[t]?(a.val(""),a.hide(),r.html("#"+t),n.attr("src",EventPost.admin.available_images[t]),e.show()):(a.show(),a.css("color","#"+t),e.hide())}})}),jQuery(".color-field-taxo").each(function(){jQuery(this).wpColorPicker({palettes:EventPost.admin.palette,change:function(e,t){var t=(t=t.color.toString()).replace("#",""),e=jQuery(e.target).closest(".taxonomy_color-wrap").siblings(".taxonomy_icon-wrap"),a=e.find(".eventpost-iconpicker"),e=e.find(".custom-marker-container"),n=e.find(".image-marker"),r=e.find(".color-hex");void 0!==EventPost.admin.available_images[t]?(a.val(""),a.hide(),r.html("#"+t),n.attr("src",EventPost.admin.available_images[t]),e.show()):(a.show(),a.css("color","#"+t),e.hide())}})})};